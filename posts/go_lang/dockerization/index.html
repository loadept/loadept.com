<!DOCTYPE html><html lang="es"> <head><meta charset="UTF-8"><title>Dockerización en Go</title><link rel="preload" href="/fonts/firacode.woff2" as="font" type="font/woff2" crossorigin="anonymous"><link rel="preload" href="/images/loadept-glitch.webp" as="image" type="image/webp" crossorigin="anonymous"><meta name="viewport" content="width=device-width"><meta name="description" content="Artículo sobre Dockerización en Go. Aprende más sobre binario, go, golang, programacion, development, docker en loadept.com"><meta name="keywords" content="binario, go, golang, programacion, development, docker"><meta name="author" content="loadept"><meta property="og:title" content="Dockerización en Go"><meta property="og:description" content="Artículo sobre Dockerización en Go. Aprende más sobre binario, go, golang, programacion, development, docker en loadept.com"><meta property="og:image" content="https://loadept.com/loadept.webp"><meta property="og:url" content="https://loadept.com/posts/go_lang/dockerization/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Dockerización en Go"><meta name="twitter:description" content="Artículo sobre Dockerización en Go. Aprende más sobre binario, go, golang, programacion, development, docker en loadept.com"><meta name="twitter:image" content="https://loadept.com/loadept.webp"><meta name="twitter:image:alt" content="Dockerización en Go"><meta name="theme-color" content="#1f2329"><link rel="icon" href="/favicon.ico" sizes="any"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="canonical" href="https://loadept.com/posts/go_lang/dockerization/"><link rel="sitemap" href="/sitemap-index.xml"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.QW52Ox2j.js"></script><link rel="stylesheet" href="/_astro/_go_package_.Bo-keN1g.css"></head> <body class="min-h-screen flex flex-col"> <header class="flex justify-between gap-1 md:mx-30 my-3 top-3 sticky"> <ul class="flex list-none m-0 p-0 justify-evenly md:gap-12 gap-3 items-center"> <li> <a href="https://github.com/loadept" target="_blank" title="github" class="hover:text-[#528bff] transition-colors"> <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="23" height="23" viewBox="0,0,256,256" class="hover:text-[#528bff] transition-colors"> <g fill="currentColor" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode:normal"> <g transform="scale(5.12,5.12)"> <path d="M17.791,46.836c0.711,-0.306 1.209,-1.013 1.209,-1.836v-5.4c0,-0.197 0.016,-0.402 0.041,-0.61c-0.014,0.004 -0.027,0.007 -0.041,0.01c0,0 -3,0 -3.6,0c-1.5,0 -2.8,-0.6 -3.4,-1.8c-0.7,-1.3 -1,-3.5 -2.8,-4.7c-0.3,-0.2 -0.1,-0.5 0.5,-0.5c0.6,0.1 1.9,0.9 2.7,2c0.9,1.1 1.8,2 3.4,2c2.487,0 3.82,-0.125 4.622,-0.555c0.934,-1.389 2.227,-2.445 3.578,-2.445v-0.025c-5.668,-0.182 -9.289,-2.066 -10.975,-4.975c-3.665,0.042 -6.856,0.405 -8.677,0.707c-0.058,-0.327 -0.108,-0.656 -0.151,-0.987c1.797,-0.296 4.843,-0.647 8.345,-0.714c-0.112,-0.276 -0.209,-0.559 -0.291,-0.849c-3.511,-0.178 -6.541,-0.039 -8.187,0.097c-0.02,-0.332 -0.047,-0.663 -0.051,-0.999c1.649,-0.135 4.597,-0.27 8.018,-0.111c-0.079,-0.5 -0.13,-1.011 -0.13,-1.543c0,-1.7 0.6,-3.5 1.7,-5c-0.5,-1.7 -1.2,-5.3 0.2,-6.6c2.7,0 4.6,1.3 5.5,2.1c1.699,-0.701 3.599,-1.101 5.699,-1.101c2.1,0 4,0.4 5.6,1.1c0.9,-0.8 2.8,-2.1 5.5,-2.1c1.5,1.4 0.7,5 0.2,6.6c1.1,1.5 1.7,3.2 1.6,5c0,0.484 -0.045,0.951 -0.11,1.409c3.499,-0.172 6.527,-0.034 8.204,0.102c-0.002,0.337 -0.033,0.666 -0.051,0.999c-1.671,-0.138 -4.775,-0.28 -8.359,-0.089c-0.089,0.336 -0.197,0.663 -0.325,0.98c3.546,0.046 6.665,0.389 8.548,0.689c-0.043,0.332 -0.093,0.661 -0.151,0.987c-1.912,-0.306 -5.171,-0.664 -8.879,-0.682c-1.665,2.878 -5.22,4.755 -10.777,4.974v0.031c2.6,0 5,3.9 5,6.6v5.4c0,0.823 0.498,1.53 1.209,1.836c9.161,-3.032 15.791,-11.672 15.791,-21.836c0,-12.682 -10.317,-23 -23,-23c-12.683,0 -23,10.318 -23,23c0,10.164 6.63,18.804 15.791,21.836z"></path> </g> </g> </svg> </a> </li> <li> <a href="https://www.linkedin.com/in/jesus-machaca-hancco-136119276" target="_blank" title="linkedin" class="hover:text-[#528bff] transition-colors"> <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="23" height="23" viewBox="0,0,256,256" class="hover:text-[#528bff] transition-colors"> <g fill="currentColor" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode:normal"> <g transform="scale(5.12,5.12)"> <path d="M41,4h-32c-2.76,0 -5,2.24 -5,5v32c0,2.76 2.24,5 5,5h32c2.76,0 5,-2.24 5,-5v-32c0,-2.76 -2.24,-5 -5,-5zM17,20v19h-6v-19zM11,14.47c0,-1.4 1.2,-2.47 3,-2.47c1.8,0 2.93,1.07 3,2.47c0,1.4 -1.12,2.53 -3,2.53c-1.8,0 -3,-1.13 -3,-2.53zM39,39h-6c0,0 0,-9.26 0,-10c0,-2 -1,-4 -3.5,-4.04h-0.08c-2.42,0 -3.42,2.06 -3.42,4.04c0,0.91 0,10 0,10h-6v-19h6v2.56c0,0 1.93,-2.56 5.81,-2.56c3.97,0 7.19,2.73 7.19,8.26z"></path> </g> </g> </svg> </a> </li> <li> <a href="https://www.tiktok.com/@loadept" target="_blank" title="tiktok" class="hover:text-[#528bff] transition-colors"> <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="23" height="23" viewBox="0,0,256,256" class="hover:text-[#528bff] transition-colors"> <g fill="currentColor" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode:normal"> <g transform="scale(5.12,5.12)"> <path d="M41,4h-32c-2.757,0 -5,2.243 -5,5v32c0,2.757 2.243,5 5,5h32c2.757,0 5,-2.243 5,-5v-32c0,-2.757 -2.243,-5 -5,-5zM37.006,22.323c-0.227,0.021 -0.457,0.035 -0.69,0.035c-2.623,0 -4.928,-1.349 -6.269,-3.388c0,5.349 0,11.435 0,11.537c0,4.709 -3.818,8.527 -8.527,8.527c-4.709,0 -8.527,-3.818 -8.527,-8.527c0,-4.709 3.818,-8.527 8.527,-8.527c0.178,0 0.352,0.016 0.527,0.027v4.202c-0.175,-0.021 -0.347,-0.053 -0.527,-0.053c-2.404,0 -4.352,1.948 -4.352,4.352c0,2.404 1.948,4.352 4.352,4.352c2.404,0 4.527,-1.894 4.527,-4.298c0,-0.095 0.042,-19.594 0.042,-19.594h4.016c0.378,3.591 3.277,6.425 6.901,6.685z"></path> </g> </g> </svg> </a> </li> <li> <a href="https://www.youtube.com/@load3pt" target="_blank" title="youtube"> <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="23" height="23" viewBox="0,0,256,256" class="hover:text-[#528bff] transition-colors"> <g fill="currentColor" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode:normal"> <g transform="scale(8.53333,8.53333)"> <path d="M15,4c-4.186,0 -9.61914,1.04883 -9.61914,1.04883l-0.01367,0.01563c-1.90652,0.30491 -3.36719,1.94317 -3.36719,3.93555v6v0.00195v5.99805v0.00195c0.00384,1.96564 1.4353,3.63719 3.37695,3.94336l0.00391,0.00586c0,0 5.43314,1.05078 9.61914,1.05078c4.186,0 9.61914,-1.05078 9.61914,-1.05078l0.00195,-0.00195c1.94389,-0.30554 3.37683,-1.97951 3.37891,-3.94727v-0.00195v-5.99805v-0.00195v-6c-0.00288,-1.96638 -1.43457,-3.63903 -3.37695,-3.94531l-0.00391,-0.00586c0,0 -5.43314,-1.04883 -9.61914,-1.04883zM12,10.39844l8,4.60156l-8,4.60156z"></path> </g> </g> </svg> </a> </li> </ul> <ul class="flex text-xs md:text-sm list-none m-0 p-0 justify-evenly md:gap-12 gap-3 items-center"> <li class="hover:text-[#528bff] transition-colors"> <a href="/" title="home">
Inicio
</a> </li> <li class="hover:text-[#528bff] transition-colors"> <a href="/about" title="about me">
Sobre mí
</a> </li> <li class="hover:text-[#528bff] transition-colors">
Contacto
</li> </ul> </header> <main class="grow mt-12">  <div class="container mx-auto px-4 max-w-4xl mb-20"> <a href="/" class="inline-flex items-center text-[#61afef] mb-8 hover:text-[#528bff] transition-colors"> <span class="text-2xl mr-1"></span> Volver al inicio </a> <article class="prose prose-invert prose-headings:text-[#e5c07b] prose-a:text-[#61afef] max-w-none"> <h1 class="text-4xl font-bold text-[#e5c07b] mb-4"> DOCKERIZACIÓN EN GO </h1> <div class="flex flex-wrap items-center text-sm text-[#5c6370] mb-8 gap-y-2"> <div class="flex items-center mr-4"> <span class="text-2xl mr-2 text-[#c678dd]"></span> 09/06/2025 </div> <div class="flex items-center flex-wrap gap-2 mt-2 w-full"> <span class="text-2xl mr-1 text-[#98c379]"></span> <span class="text-xs px-2 py-1 rounded-md bg-[#282c34] text-[#abb2bf] border border-[#3e4451]"> binario </span><span class="text-xs px-2 py-1 rounded-md bg-[#282c34] text-[#abb2bf] border border-[#3e4451]"> go </span><span class="text-xs px-2 py-1 rounded-md bg-[#282c34] text-[#abb2bf] border border-[#3e4451]"> golang </span><span class="text-xs px-2 py-1 rounded-md bg-[#282c34] text-[#abb2bf] border border-[#3e4451]"> programacion </span><span class="text-xs px-2 py-1 rounded-md bg-[#282c34] text-[#abb2bf] border border-[#3e4451]"> development </span><span class="text-xs px-2 py-1 rounded-md bg-[#282c34] text-[#abb2bf] border border-[#3e4451]"> docker </span> </div> </div> <p>Conocer cómo dockerizar de manera correcta en <strong>Go</strong> es muy importante, ya que puede tener un impacto positivo en el rendimiento, el consumo de recursos y el almacenamiento. Entender aspectos como <strong>multi-stage builds</strong> o el uso de versiones ligeras de las imágenes puede ser muy útil.</p>
<h2 id="qué-imagen-usar">¿Qué imagen usar?</h2>
<p>Para la dockerización con buenas prácticas en <strong>Go</strong>, siempre es recomendable usar versiones <code>alpine</code> de las imágenes de <strong>golang</strong>. Dependiendo de la versión de <strong>Go</strong> que estemos utilizando, podemos elegir imágenes como <code>golang:1.23.4-alpine3.21</code>. Las versiones dependen de nuestra necesidad: si queremos una versión específica, una versión flexible con respecto al parche, etc.</p>
<p>A continuación, dockerizaremos una pequeña API usando una versión flexible de Alpine.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="diff"><code><span class="line"><span style="color:#85E89D"><span style="user-select: none;">+</span> FROM golang:1.23-alpine3.21</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D"><span style="user-select: none;">+</span> RUN apk add --no-cache git</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D"><span style="user-select: none;">+</span> WORKDIR /app</span></span></code></pre>
<p>La versión actual con la que se creó la API es <strong>1.23.0</strong>, pero no hay una versión específica del parche disponible. Por lo tanto, usaremos la imagen sin especificar el parche. También descargamos <code>git</code> usando <code>apk</code> (<em>Gestor de paquetes en alpine</em>) sin almacenar en caché para aligerar la imagen, por ultimo establecemos el entorno de trabajo (<code>WORKDIR</code>), que será el espacio o <code>$HOME</code> dentro del contenedor, donde se almacenaran los archivos o recursos copiados o descargados.</p>
<h2 id="copiando-de-dependencias-por-separado">Copiando de dependencias por separado</h2>
<p>A continuación, copiamos los archivos de dependencias de <strong>Go</strong> (<code>go.mod</code> y <code>go.sum</code>) y descargamos las dependencias en la imagen:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="diff"><code><span class="line"><span style="color:#E1E4E8">FROM golang:1.23-alpine3.21</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">RUN apk add --no-cache git</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">WORKDIR /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D"><span style="user-select: none;">+</span> COPY go.mod go.sum ./</span></span></code></pre>
<blockquote>
<p><strong>¿Por qué copiamos <code>go.mod</code> y <code>go.sum</code> de forma separada?</strong>
Esto lo hacemos para aprovechar la caché de <strong>Docker</strong>. Al copiar estos archivos por separado, si se modifica algún archivo de código excepto las dependencias, <strong>Docker</strong> no volverá a descargarlas. Esto acelera la construcción de la imagen, ya que <strong>Docker</strong> utiliza un sistema de capas y cada instrucción en el <code>Dockerfile</code> corresponde a una capa independiente, si no se modifican estos archivos <strong>Docker</strong> podrá reutilizar la capa sin necesidad de descargar nuevamente todas las dependencias.
Y, si hacemos un <code>COPY . .</code> para copiar todo el código fuente, los archivos de dependencias e instalarlas en una sola capa, cualquier cambio en los archivos reiniciará el proceso completo, lo que incluye volver a descargar las dependencias. Al separar estas acciones en diferentes capas, evitamos este problema.</p>
</blockquote>
<p>Ahora descargamos las dependencias:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="diff"><code><span class="line"><span style="color:#E1E4E8">FROM golang:1.23-alpine3.21</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">RUN apk add --no-cache git</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">WORKDIR /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">COPY go.mod go.sum ./</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D"><span style="user-select: none;">+</span> RUN go mod download</span></span></code></pre>
<blockquote>
<p><strong>¿Por qué descargamos dependencias?</strong>
Esto lo hacemos para que las dependencias estén en la caché del sistema, así al compilar, <strong>Go</strong> se saltará el proceso de descargarlo por si solo, porque internamente este, descarga las dependencias al compilar por lo que puede tardar un tiempo, así que nosotros lo hacemos manualmente en una capa diferente para ahorrar tiempo y aprovechar la caché de <strong>Docker</strong>.</p>
</blockquote>
<p>Después, copiamos el resto del código fuente al área de trabajo:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="diff"><code><span class="line"><span style="color:#E1E4E8">FROM golang:1.23-alpine3.21</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">RUN apk add --no-cache git</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">WORKDIR /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">COPY go.mod go.sum ./</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">RUN go mod download</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D"><span style="user-select: none;">+</span> COPY . .</span></span></code></pre>
<blockquote>
<p>Con este paso, garantizamos que cualquier cambio en el código fuente no afecte las capas anteriores.</p>
</blockquote>
<h2 id="compilar-el-código">Compilar el código</h2>
<p>En este paso, convertimos todo el código en un binario ejecutable:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="diff"><code><span class="line"><span style="color:#E1E4E8">FROM golang:1.23-alpine3.21</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">RUN apk add --no-cache git</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">WORKDIR /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">COPY go.mod go.sum ./</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">RUN go mod download</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">COPY . .</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D"><span style="user-select: none;">+</span> RUN go build cmd/app/main.go</span></span></code></pre>
<p>Este comando genera un binario dentro del directorio de trabajo (<code>/app</code>). El archivo resultante será <code>/app/main</code>.</p>
<p>Podríamos finalizar aquí la dockerización, agregando un <code>CMD</code> o <code>ENTRYPOINT</code> para ejecutar el binario, pero nosotros queremos exprimir al máximo la optimización, así que vamos a hacer uso de <strong>multi-stage builds</strong></p>
<h2 id="uso-de-multi-stage-builds">Uso de Multi-Stage Builds.</h2>
<p>Los <strong>multi-stage builds</strong> permiten tener múltiples etapas dentro de un <code>Dockerfile</code>. Esto ayuda a reducir el tamaño final de la imagen, ya que los archivos temporales o innecesarios de la etapa de construcción serán “limpiados” por lo que no se incluyen en la imagen final.
Resultando así en un contenedor más pequeño y con un menor consumo.</p>
<h2 id="creando-el-entorno-de-construcción">Creando el entorno de construcción</h2>
<p>Para hacer uso de <strong>multi-stage builds</strong> necesitamos primero cambiar la primera línea, haremos uso de <strong>aliases</strong> para nombrar nuestras etapas, por ejemplo vamos a nombrar nuestra etapa actual como <code>build</code>, porque es el área de descarga y compilación.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="diff"><code><span class="line"><span style="color:#FDAEB7"><span style="user-select: none;">-</span> FROM golang:1.23-alpine3.21</span></span>
<span class="line"><span style="color:#85E89D"><span style="user-select: none;">+</span> FROM golang:1.23-alpine3.21 AS build</span></span></code></pre>
<h2 id="creando-el-entorno-de-ejecución">Creando el entorno de ejecución</h2>
<p>Cada etapa necesita una nueva imagen, en nuestra etapa de construcción hicimos uso de la imagen de <code>golang</code> en la que descargamos dependencias y compilamos. Ahora, nuestra segunda etapa, necesita de una imagen también, podríamos hacer uso de la imagen de <code>golang</code> nuevamente, pero, hay que tener en cuenta que esta imagen puede ser pesada, ya que trae todo lo necesario para compilar o ejecutar nuestro código <code>golang</code>, trae el compilador, formateador, caché o gestor de dependencias, lo que hace que esta imagen sea pesada.</p>
<p>Ya que actualmente solo necesitamos de un pequeño entorno donde ejecutar nuestro binario, no necesitamos mucho, así que haremos uso de una imagen pequeña de <code>alpine</code> en su versión <code>3.21</code> que es la misma versión <code>alpine</code> correspondiente a la usada con <code>golang</code>.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="diff"><code><span class="line"><span style="color:#E1E4E8">FROM golang:1.23-alpine3.21 AS build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">RUN apk add --no-cache git</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">WORKDIR /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">COPY go.mod go.sum ./</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">RUN go mod download</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">COPY . .</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">RUN go build cmd/app/main.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D"><span style="user-select: none;">+</span> FROM alpine:3.21</span></span></code></pre>
<p>Listo, así creamos nuestra etapa, ahora vamos a repetir ligeramente los pasos, como creación de un espacio de trabajo, y vamos a copiar nuestros archivos, pero lo haremos de diferente manera.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="diff"><code><span class="line"><span style="color:#E1E4E8">FROM golang:1.23-alpine3.21 AS build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">RUN apk add --no-cache git</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">WORKDIR /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">COPY go.mod go.sum ./</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">RUN go mod download</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">COPY . .</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">RUN go build cmd/app/main.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">FROM alpine:3.21</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D"><span style="user-select: none;">+</span> WORKDIR /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D"><span style="user-select: none;">+</span> COPY --from=build /app/main .</span></span></code></pre>
<p>Aplicamos un <code>COPY --from</code> el cual nos permite copiar recursos entre diferentes etapas, en este caso desde la etapa <code>build</code>, donde se copia el binario que se encuentra en espacio de trabajo <code>/app</code> (<code>/app/main</code>) el cual es el binario resultante después de la compilación.</p>
<p>Hecho esto, solo quedaría dictar el <code>CMD</code> o <code>ENTRYPOINT</code>para ejecutar nuestro binario.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="diff"><code><span class="line"><span style="color:#E1E4E8">FROM golang:1.23-alpine3.21 AS build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">RUN apk add --no-cache git</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">WORKDIR /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">COPY go.mod go.sum ./</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">RUN go mod download</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">COPY . .</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">RUN go build cmd/app/main.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">FROM alpine:3.21</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">WORKDIR /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">COPY --from=build /app/main .</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D"><span style="user-select: none;">+</span> ENTRYPOINT [ "./main" ]</span></span></code></pre>
<p>Finalmente logramos dockerizar nuestra aplicación en <strong>Go</strong>, es una dockerización que sigue las mejores prácticas, ligera y muy rápida, haciendo uso correcto de la caché de <strong>Docker</strong> y múltiples etapas.</p>
<h1 id="comparación">Comparación</h1>
<p>Vamos a hacer una pequeña comparación de una dockerización bien optimizada versus una que no, y vamos a recordar el por qué debemos hacer cada cosa.</p>
<h2 id="malas-prácticas">Malas prácticas</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="dockerfile"><code><span class="line"><span style="color:#F97583">FROM</span><span style="color:#E1E4E8"> golang:1.23</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">WORKDIR</span><span style="color:#E1E4E8"> /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">COPY</span><span style="color:#E1E4E8"> . .</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">RUN</span><span style="color:#E1E4E8"> go build cmd/app/main.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">ENTRYPOINT</span><span style="color:#E1E4E8"> [ </span><span style="color:#9ECBFF">"./main"</span><span style="color:#E1E4E8"> ]</span></span></code></pre>
<h3 id="resultado">Resultado</h3>
<p><img src="https://github.com/user-attachments/assets/40081688-fe47-460f-8f6b-abbf3f103615" alt="Pasted image 20250108015147"></p>
<blockquote>
<p>En este ejemplo se muestra un archivo <code>Dockerfile</code> mal optimizado, no hace uso de <a href="#qu%C3%A9-imagen-usar">versiones ligeras como alpine</a> o <a href="#copiando-de-dependencias-por-separado">copiado de archivos de dependencias por separado</a>, ya que hace uso de un solo <code>COPY . .</code> para copiar directamente los archivos de dependencias y el código fuente y la falta de uso múltiples etapas de construcción, lo que podría traer consecuencias negativas a la hora de la construcción como tiempos muy exagerados o imágenes muy pesadas, como en este caso, donde la imagen llega a pesar <strong>1.08GB</strong>.</p>
</blockquote>
<h2 id="buenas-prácticas">Buenas prácticas</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="dockerfile"><code><span class="line"><span style="color:#F97583">FROM</span><span style="color:#E1E4E8"> golang:1.23-alpine3.21 </span><span style="color:#F97583">AS</span><span style="color:#E1E4E8"> build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">RUN</span><span style="color:#E1E4E8"> apk add --no-cache git</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">WORKDIR</span><span style="color:#E1E4E8"> /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">COPY</span><span style="color:#E1E4E8"> go.mod go.sum ./</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">RUN</span><span style="color:#E1E4E8"> go mod download</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">COPY</span><span style="color:#E1E4E8"> . .</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">RUN</span><span style="color:#E1E4E8"> go build cmd/app/main.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">FROM</span><span style="color:#E1E4E8"> alpine:3.21</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">WORKDIR</span><span style="color:#E1E4E8"> /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">COPY</span><span style="color:#E1E4E8"> --from=build /app/main .</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">ENTRYPOINT</span><span style="color:#E1E4E8"> [ </span><span style="color:#9ECBFF">"./main"</span><span style="color:#E1E4E8"> ]</span></span></code></pre>
<h3 id="resultado-1">Resultado</h3>
<p><img src="https://github.com/user-attachments/assets/5f7cfc33-4719-4057-9f50-2d3e832e321d" alt="Pasted image 20250108015742"></p>
<blockquote>
<p>Este es el ejemplo que realizamos utilizando las mejores prácticas de optimización y construcción, haciendo uso correcto de la caché de <strong>Docker</strong>, multiples etapas de construcción y versiones ligeras de imágenes, lo que se ve reflejado en el tamaño de imagen y tiempo de construcción.</p>
</blockquote>
<h1 id="consideraciones-finales">Consideraciones finales</h1>
<p>Algunas dependencias pueden hacer uso de una característica de <strong>Go</strong> que es <code>CGO</code> que permite ejecutar módulos en <strong>C</strong> desde nuestras apps en <strong>Go</strong>. Para poder hacer uso de esta característica basta con habilitar la variable <code>CGO_ENABLED=1</code> a la hora de compilar nuestras aplicaciones. No hacer esto podría traer fallas en la ejecución o compilación de nuestros programas.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="diff"><code><span class="line"><span style="color:#E1E4E8">FROM golang:1.23-alpine3.21 AS build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D"><span style="user-select: none;">+</span> ENV CGO_ENABLED=1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">RUN apk add --no-cache git</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">WORKDIR /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">COPY go.mod go.sum ./</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">RUN go mod download</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">COPY . .</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">RUN go build cmd/app/main.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">FROM alpine:3.21</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">WORKDIR /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">COPY --from=build /app/main .</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">ENTRYPOINT [ "./main" ]</span></span></code></pre>
<p>Hecho esto podremos hacer uso de los módulos en <strong>C</strong> para <strong>Go</strong> como <code>librdkafka</code> para trabajar con <strong>Apache Kafka</strong> u otros módulos.</p> </article> </div>  </main> <footer class="py-5 bg-linear-to-t from-[#282c34] via-90% via-[#282c34] to-[#1f2329]"> <div class="container mx-auto px-4"> <div class="flex items-center justify-between text-center"> <p class="text-xs text-[#abb2bf]"> <span class="text-[#c678dd]">loadept</span> <span class="text-[#e06c75]">-</span> 2026 </p> <a href="https://github.com/loadept/loadept.com" target="_blank" title="source" class="text-xs"> <span class="outline-none text-[#e06c75] border-b">Código fuente</span> </a> </div> </div> </footer> </body></html>